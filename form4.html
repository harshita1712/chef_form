<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Hostnames Input</title>
</head>
<body>
    <h1>Enter Server Hostnames</h1>
    <form id="hostnameForm">
        <label for="hostnames">Server Hostnames:</label>
        <textarea id="hostnames" name="hostnames" rows="5" cols="50"></textarea>
        <br>
        <input type="submit" value="submit">
        <div id="loading-screen" style="display: none">
            <p>Loading...</p>
        </div>
        <p id="current-hostname" ></p>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("hostnameForm").addEventListener("submit", function (event) {
                event.preventDefault();
                const hostnameForm = document.getElementById("hostnameForm");
                const hostnamesTextarea = document.getElementById("hostnames");
                const loadingScreen = document.getElementById("loading-screen");
                const currentHostnameElement = document.getElementById("current-hostname");
                const hostnames = hostnamesTextarea.value.trim().split("\n");

                if (hostnames.length === 0) {
                    alert("Please enter at least one hostname.");
                    return;
                }

                localStorage.setItem("hostnames", JSON.stringify(hostnames));
                let currentIndex = 0;
                function sendRequest() {
                    if (currentIndex < hostnames.length) {
                        const currentHostname = hostnames[currentIndex];
                        currentHostnameElement.textContent = `Current Hostname: ${currentHostname}`;
                        loadingScreen.style.display = "block";

                        fetch("/store_hostnames", {
                            method: "POST",
                            body: JSON.stringify({ hostnames: currentHostname }),
                            headers: {
                                "Content-Type": "application/json",
                            },
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                console.log(data);
                                currentIndex++;
                                setTimeout(sendRequest, 1000);
                            })
                            .catch((error) => {
                                console.error(error);
                                currentIndex++;
                            });
                    } else {
                        loadingScreen.style.display = "none";
                        currentHostnameElement.textContent = "Processed";
                    }
                }
                sendRequest();
            });
        });
    </script>
</body>
</html>